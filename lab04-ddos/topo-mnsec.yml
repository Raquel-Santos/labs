name: Lab DDoS
defaults:
  env:
    DEFENVVAR1: xpto
  # hosts_kind: default
  # switches_kind: default
  # links_kind: default
hosts:
  h1:
    ip: 192.168.1.1/24
    defaultRoute: via 192.168.1.254
  h2:
    ip: 192.168.1.2/24
    defaultRoute: via 192.168.1.254
    postStart:
      - /root/labs/lab04-ddos/lab-data/static/system_monitor.sh &
  h3:
    ip: 192.168.1.3/24
    defaultRoute: via 192.168.1.254
  h4:
    ip: 192.168.1.4/24
    defaultRoute: via 192.168.1.254
    postStart:
      - /root/labs/lab04-ddos/lab-data/static/system_monitor.sh &
  h5:
    ip: 192.168.1.5/24
    defaultRoute: via 192.168.1.254
    postStart:
      - /root/labs/lab04-ddos/lab-data/static/system_monitor.sh &
  h6:
    ip: 192.168.1.6/24
    defaultRoute: via 192.168.1.254
    kind: k8spod
    image: hackinsdn/debian:latest
  h7:
    ip: 192.168.1.7/24
    defaultRoute: via 192.168.1.254
    kind: k8spod
    image: hackinsdn/debian:latest
  h8:
    ip: 192.168.1.8/24
    defaultRoute: via 192.168.1.254
    kind: k8spod
    image: hackinsdn/debian:latest
  h9:
    ip: 192.168.1.9/24
    defaultRoute: via 192.168.1.254
    postStart:
      - /root/labs/lab04-ddos/lab-data/static/system_monitor.sh &
  srv1:
    ip: 192.168.1.254/24
    kind: k8spod
    image: hackinsdn/vuln-ssl-heartbleed:latest
    postStart:
      - echo "<html><body><h1>Welcome to HackInSDN.com</h1></body></html>" > /var/www/index.html
  srv2:
    kind: iptables
  c1:
    kind: k8spod
    image: hackinsdn/kytos:allinone
    args: ["-E"]
    env:
    - name: "MONGO_USERNAME"
      value: "kytos"
    - name: "MONGO_PASSWORD"
      value: "kytos"
    - name: "MONGO_DBNAME"
      value: "kytos"
    - name: "MONGO_HOST_SEEDS"
      value: "127.0.0.1:27017"
    publish:
    - "6653:6653"
    - "8181:8181"
  c2c:
    ip: 192.168.1.250/24
    publish:
    - "5000:5000"
    postStart:
      - tar -czf /root/labs/lab04-ddos/lab-data/static/hping3-libs.tgz /lib/x86_64-linux-gnu/libpcap.so* /lib/x86_64-linux-gnu/libtcl8.6.so* /lib/x86_64-linux-gnu/libdbus-1.so*
      - cp /usr/local/bin/slowloris /root/labs/lab04-ddos/lab-data/static/
      - ln -s /usr/local/bin/slowloris /usr/bin/linux_verify
      - cp /usr/sbin/hping3 /root/labs/lab04-ddos/lab-data/static/
      - ln -s /usr/sbin/hping3 /usr/bin/linux_checker
      - python3 /root/labs/lab04-ddos/lab-data/ddos-cmd-ctl.py &
switches:
  s1:
    kind: ovs
  s2:
    kind: lxbr
links:
  - node1: h1
    node2: s1
  - node1: s1
    node2: s2
  - node1: h2
    node2: s2
  - node1: h3
    node2: s2
  - node1: h4
    node2: s2
  - node1: h5
    node2: s1
  - node1: h6
    node2: s1
  - node1: h7
    node2: s1
  - node1: h8
    node2: s1
  - node1: h9
    node2: s1
  - node1: srv1
    node2: s1
    kind: tc
    bw: 100
  - node1: c2c
    node2: s1
  - node1: srv2
    node2: s1
    port1: 0
    port2: 20
  - node1: srv2
    node2: s1
    port1: 1
    port2: 21
