# Laboratório de Análise de Malware - Execução, Analise e Contenção
![Topology](https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/lab_analyze_malware/lab_analyze_malware/images/topology_lab_malware_reduce.png)
*Figura 1: Topologia do Laboratório*

## Ativida 1: Teste de Conectividade:
## Atividade 2: Exposição ao Malware por meio de Engenharia Social:

A técnica de engenharia social explora falhas humanas, visando persuadir a vítima a efetuar ações que facilitem o acesso indevido a sistemas restritos. Por meio da manipulação emocional, os atacantes transmitem mensagens geralmente com caráter de urgência com a intenção de provocar emoções como, por exemplo, medo, empolgação, curiosidade, para assim convencê-la. Após conseguir a confiança da vítima, o atacante consegue efetuar o roubo de informações pessoais e dinheiro, realizar infecções por malware, ou qualquer outra ação que pode gerar prejuízos ao usuário. O phishing, golpes de baiting, ataques de pretexto e ataques de DNS spoofing são apenas alguns exemplos de ataques que utilizam a engenharia social como base. 

Na Figura 2, é apresentado um exemplo de phishing bastante comum que tem sido transmitido via email. A mensagem é referente a um falso mandado de intimação judicial, na vítima é persuadida a efetuar o download do documento para ter acesso a mais informações informações a respeito do mandado, no entanto, ao clicar no link disponibilizado na mensagem um arquivo malicioso é baixado no sistema da vítima e caso executado poderá roubar informações do usuário. Este foi um caso real relatado no site no Catálogo de Fraudes da RNP, o qual é um repositório de mensagens classificadas como fraudulentas, que pode ser utilizado como uma fonte de informação que auxilia a não propagação de fraudes disseminadas por email e fornecendo informações sobre como se proteger desse tipo de golpe.

![Fraude](https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/lab_analyze_malware/lab_analyze_malware/images/fraud16510.jpg)

*Figura 2: Fraude 16510 - catalogodefraudes.rnp.br*


*Questionário: Qual seria uma boa ação a se tomar ao receber um e-mail como o apresentado na Figura 2?*

*Questionário: Um dos ataques que utilizam a técnica de engenharia social são ataques watering hole, explique como esse tipo de ataque ocorre:*

## 2.1 - Execução de Ataques:


Para este laboratório vamos simular uma infecção por malware ocasionada por um ataque de phishing similar ao que foi divulgado pelo Catálogo de Fraudes da RNP. Na mensagem fictícia abaixo, cujo assunto é Resgate de Brindes, o usuário é induzido a clicar em um link para resgatar brindes de um suposto sorteio realizado por uma empresa de varejo.


````
Olá, Cliente!

Temos uma ótima notícia para você! Seu e-mail foi sorteado no nosso sorteio anual de fidelização. Todos os anos, a nossa empresa realiza essa ação para presentear clientes como você, que fazem parte da nossa jornada com tanto carinho e confiança.

É a nossa forma de agradecer pelo excelente relacionamento e por nos escolher!

Clique no link abaixo para resgatar os brindes especiais que preparamos para você:

[Clique aqui para resgatar!]

Atenção: O link ficará disponível apenas pelas próximas 24h, a partir deste momento. Não perca!

Atenciosamente,
Equipe de Gestão de Relacionamento
VarejoEmFoco Ltda

Este é um e-mail automático. Por favor, não responda.
````

Agora, imagine que essa mensagem chegou à sua caixa de entrada. A primeira ação que você deve tomar é verificar se o remetente realmente pertence à empresa mencionada. Com uma rápida pesquisa no Google, você conseguirá encontrar mais informações sobre a empresa.
No caso da mensagem que estamos analisando, foi utilizada uma empresa fictícia, o que já nos levanta suspeitas sobre a veracidade das informações contidas no e-mail. Note que o atacante utiliza o fator da urgência para tentar pressionar o usuário a clicar no link rapidamente, com a promessa de uma recompensa falsa.
Um usuário atento se perguntaria se, de fato, está lidando com uma empresa com a qual tem relacionamento. A mensagem afirma que você foi incluído no sorteio devido à sua fidelidade com a empresa, o que indica que não deveria se tratar de uma empresa desconhecida para você.
Caso ainda tenha dúvidas sobre a autenticidade da mensagem, uma boa prática é, antes de clicar no link, compartilhar a URL em serviços de identificação de URLs maliciosas, como o CaUMa e o VirusTotal, por exemplo. Esses serviços mantêm uma base de dados de URLs maliciosas, coletadas pelo sistema ou reportadas por usuários, com o objetivo de identificar links suspeitos ou perigosos.

Vamos supor que você é um usuário desatento e não seguiu as recomendações feitas anteriormente e clicou no link contido na mensagem. Após clicar, um arquivo será instalado na sua máquina. Este arquivo se trata de um ransomware. O primeiro passo é fazer o download dos scripts e arquivos necessários para simular o ataque. Disponibilizamos um arquivo que será criptografado e scripts para efetuar a criptografia e descriptografia desse arquivo:

Acesse o terminal do Mininet-Sec a partir do Dashboard HackInSDN para efetuar o download dos arquivos:

*Imagem do painel do Dashboard HackInSDN*

Em seguida, no terminal do Mininet-Sec, execute os seguintes comandos:


````
cd /tmp
````
````
curl -LO https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/main/lab_analyze_malware/ ransomware/encrypter.py
````
````
curl -LO https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/main/lab_analyze_malware/ ransomware/decrypter.py
````
````
curl -LO https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/main/lab_analyze_malware/ ransomware/hackinsdn.txt
````

## 2.1.1 - Ataque de Ransomware:

De acordo com a revista Exame, o Brasil ficou entre os cinco países mais atacados por ransomware no ano de 2024. Leia mais leia mais [aqui](https://exame.com/tecnologia/brasil-esta-entre-os-cinco-paises-mais-atacados-por-ransomware/). Notícias como esta revelam que os ataques de ransomware estão crescendo e representam uma grande ameaça à segurança digital. Esse ataque consiste na execução de um malware que criptografa arquivos externos e bloqueia o acesso do usuário dono dos arquivos. Em seguida, o cibercriminoso solicita que a vítima transfira um valor para o resgate dos dados; geralmente, esse valor é pago em criptomoedas. Apesar de grandes empresas serem os alvos mais recorrentes desse tipo de ataque, usuários comuns também estão sujeitos a essa ameaça.
Para simular na prática como o ransomware funciona, vamos imaginar que você é um usuário desatento e clicou no e-mail “Resgate de Brindes” apresentado no tópico 2.1. O download dos arquivos foi realizado na secção anterior, o próximo passo é executar o arquivo no host h101:

O Mininet-Sec é um emulador de redes responsável pela criação da topologia apresentada na Figura 1. Clique no link do Serviço "http-mininet-sec" conforme ilustrado abaixo para abrir a interface web do Mininet-Sec:

*Imagem do Mininet-Sec*

Vamos utilizar o aplicativo mnsecx (mininet-sec exec) para executar comandos em nós específicos da topologia. Neste exemplo, vamos simular um ataque de ransomware  a partir do host h101, execute o seguinte comando no Terminal do Mininet-Sec:

````
cat /tmp/hackinsdn.txt
````
````
mnsecx -a $(pidof h1) cp /tmp/hackinsdn.png /tmp/hackinsdn.txt
````
````
mnsecx -I -L -a $(pidof h101) python /tmp/encrypter.py
````
O comando acima vai criptografar o texto hackinsdn.txt, substituindo-a por hackinsdn.txt.ransomware.

````
mnsecx -a $(pidof h1) cat /tmp/hackinsdn.txt.ransomware
````

## 2.1.2 - Criptografia Maliciosa:

A criptografia maliciosa é um ataque que ocorre na execução não autorizada de um binário em um computador ou dispositivo móvel, com o intuito de utilizar seus recursos para minerar criptomoedas. O processo de mineração de criptomoedas requer bastante energia e recursos computacionais. Os cibercriminosos efetuaram esse tipo de ataque para não pagar por esses recursos, ou seja, para extrair a criptomoeda sem as grandes despesas.

Similar ao que fizemos na simulação do ataque de ransomware, vamos supor que, ao efetuar o download dos arquivos disponibilizados no link do e-mail “Resgate de Brindes”, você instalou um executável com o intuito de realizar a mineração de bitcoin.Vamos executar no h101 o arquivo bitcoinMining.py.

Acesse o terminal do host h101 a partir do Dashboard HackInSDN para verificar o monitoramento da CPU e do disco:

*Imagem do painel do Dashboard HackInSDN*

Em seguida, no terminal do host h101, execute os seguintes comandos:

````
htop
````
Este comando permite que você exiba em tempo real o consumo de CPU, memória, e outros recursos do sistema.

````
mpstat -P ALL 1
````
Este comando permite que você veja estatísticas detalhadas da CPU ao longo do tempo, com os parâmetros -P ALL 1 o uso da CPU será exibido a cada 1 segundo para todos os núcleos.

````
iotop
````
Este comando mostra a atividade de entrada/saída do disco em tempo real.

````
du -sh /tmp/
````
Este comando mostrará o tamanho total de todos os arquivos no diretório /tmp.

Acesse o terminal do Mininet-Sec a partir do Dashboard HackInSDN para efetuar o download do arquivo:

*Imagem do painel do Dashboard HackInSDN*

Em seguida, no terminal do Mininet-Sec, execute os seguintes comandos:

````
cd /tmp
````

````
curl -LO https://raw.githubusercontent.com/hackinsdn/labs/refs/heads/main/lab_analyze_malware/maliciousEncryption/bitcoinMining.py
````

````
mnsecx -I -L -a $(pidof h101) python /tmp/bitcoinMining.py
````

## Atividade 3 - Análise de Malware:

Na seção anterior, simulamos um ataque de criptografia maliciosa. Agora, vamos utilizar algumas ferramentas para analisar os impactos gerados por este script.

Acesse o terminal do Mininet-Sec a partir do Dashboard HackInSDN para verificar se ocorrem alterações no consumo da CPU e do disco no host h101:

*Imagem do painel do Dashboard HackInSDN*

Em seguida, no terminal do Mininet-Sec, execute os seguintes comandos:

````
h101 htop
````
Este comando permite que você exiba em tempo real o consumo de CPU, memória, e outros recursos do sistema.

````
h101 du -sh /tmp/
````
Este comando mostrará o tamanho total de todos os arquivos no diretório /tmp.

````
h101 mpstat -P ALL 1
````
Este comando permite que você veja estatísticas detalhadas da CPU ao longo do tempo, com os parâmetros -P ALL 1 o uso da CPU será exibido a cada 1 segundo para todos os núcleos.

````
h101 iotop
````
Este comando mostra a atividade de entrada/saída do disco em tempo real.

## Atividade 4: Contenção:

## Atividade 5: Processo de importação de hash de arquivos no MISP:




